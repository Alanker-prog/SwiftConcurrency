//
//  15.Refreshable.swift
//  SwiftConcurrency
//
//  Created by –ê–ª–∞–Ω –ü–∞—Ä–∞—Å—Ç–∞–µ–≤ on 31.10.2025.
//

import SwiftUI
import Combine

/*
‚öôÔ∏èüîª func getData() async throws -> [String] { - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—à–∞–µ—Ç —Å—Ç—Ä–∏–Ω–≥–æ–≤—ã–π –º–∞—Å—Å–∏–≤
      ‚û°Ô∏è try? - –æ–∑–Ω–∞—á–∞–µ—Ç: –µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –æ—Ç–º–µ–Ω–∏—Ç –∑–∞–¥–∞—á—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —É—Ö–æ–¥–µ —Å —ç–∫—Ä–∞–Ω–∞), –æ—à–∏–±–∫–∏ –Ω–µ –±—É–¥–µ—Ç ‚Äî –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç.
      ‚û°Ô∏è Task.sleep ‚Äî –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏, –Ω–∞ –¥–≤–µ —Å–µ–∫—É–Ω–¥—ã
      ‚û°Ô∏è return ["Aplle", "Orange", "Banana"].shuffled() - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ (–Ω–∞–∑–≤–∞–Ω–∏—è —Ñ—Ä—É–∫—Ç–æ–≤), shuffled() –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π —Ä–∞–∑ —Å–ø–∏—Å–æ–∫ –±—ã–ª —Å–ª—É—á–∞–π–Ω—ã–º.
 */
final class RefreshableBootcampDataService {
    
    func getData() async throws -> [String] {
        try? await Task.sleep(nanoseconds: 2_000_000_000)
       return ["Aplle", "Orange", "Banana"].shuffled()
    }
    
}

/*
 ‚úÖ @Published private(set) var items: [String] = []
    ‚û°Ô∏è @Published —Å–æ–æ–±—â–∞–µ—Ç SwiftUI: ¬´—Å–ª–µ–¥–∏ –∑–∞ —ç—Ç–∏–º —Å–≤–æ–π—Å—Ç–≤–æ–º¬ª.private(set) –∑–Ω–∞—á–∏—Ç: ViewModel –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å items, –Ω–æ View ‚Äî —Ç–æ–ª—å–∫–æ —á–∏—Ç–∞—Ç—å.  = [] –ù–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤.
 
 ‚öôÔ∏èüîª func loadData() async {
    ‚û°Ô∏è try await manager.getData() ‚Äî –ø—Ä–æ–±—É–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –∫–ª–∞—Å—Å–∞ DataService –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ getData()
    ‚û°Ô∏è await –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é, –ø–æ–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è. –ü–æ—Å–ª–µ 2 —Å–µ–∫—É–Ω–¥ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ.
    ‚û°Ô∏è –ü–æ–ª—É—á–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –≤ items: -> items = ["Banana", "Orange", "Apple"]
    ‚û°Ô∏è –ü–æ—Å–∫–æ–ª—å–∫—É items ‚Äî @Published, SwiftUI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
    ‚ö†Ô∏è –ï—Å–ª–∏ –≤–¥—Ä—É–≥ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ ‚Äî –æ–Ω–∞ –ø–æ–ø–∞–¥—ë—Ç –≤ catch, –∏ –≤—ã–≤–µ–¥–µ—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å.
 */
final class RefreshableBootcampViewModel: ObservableObject {
    @Published private(set) var items: [String] = []
    let manager = RefreshableBootcampDataService()
    
    func loadData() async {
            do {
                items = try await manager.getData()
            } catch {
                print(error)
            }
        }
    }

/*
 üî¥ .refreshable { await vm.loadData() }
 ‚ö†Ô∏è –≠—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π SwiftUI –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä, –ø–æ—è–≤–∏–≤—à–∏–π—Å—è —Å iOS 15.–î–æ–±–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ—Ç—è–Ω—É—Ç—å –≤–Ω–∏–∑, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫.
 ‚û°Ô∏è –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç ¬´pull to refresh¬ª, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è vm.loadData().–ü–æ—Å–∫–æ–ª—å–∫—É –º–µ—Ç–æ–¥ async, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è await.
 üîÅ –ü–æ—Å–ª–µ –æ—Ç–ø—É—Å–∫–∞–Ω–∏—è —ç–∫—Ä–∞–Ω–∞ SwiftUI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏–Ω–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏,–∂–¥—ë—Ç 2 —Å–µ–∫—É–Ω–¥—ã (–∏–∑-–∑–∞ Task.sleep),–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ—Ä—É–∫—Ç–æ–≤ –≤ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.
 ‚ùï–¢–∞–∫ –∂–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å ProgressView –≤–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è —ç—Ç–∏—Ö 2 —Å–µ–∫—É–Ω–¥, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª, —á—Ç–æ –∏–¥—ë—Ç –∑–∞–≥—Ä—É–∑–∫–∞
 
 üü° .task { await vm.loadData() }
     ‚û°Ô∏è –≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ View –Ω–∞ —ç–∫—Ä–∞–Ω–µ. .task —Å–æ–∑–¥–∞—ë—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –∑–∞–¥–∞—á—É, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ View.–¢–æ –µ—Å—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —ç–∫—Ä–∞–Ω–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è await vm.loadData().
     ‚úÖ –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º: –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —ç–∫—Ä–∞–Ω–∞ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –ø—Ä–∏ –ø–æ—Ç—è–≥–∏–≤–∞–Ω–∏–∏ –≤–Ω–∏–∑ –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∏—Ö –≤—Ä—É—á–Ω—É—é.
 */
struct RefreshableBootcamp: View {
    
    @StateObject private var vm = RefreshableBootcampViewModel()
    
    var body: some View {
        NavigationStack {
            ScrollView {
                VStack {
                    ForEach(vm.items, id: \.self) { item in
                        Text(item)
                            .font(.headline)
                    }
                }
            }
            .refreshable {
               await vm.loadData()
            }
            .navigationTitle("Refreshable")
            .task {
               await vm.loadData()
            }
        }
    }
}

#Preview {
    RefreshableBootcamp()
}
