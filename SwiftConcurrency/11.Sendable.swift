//
//  11.Sendable.swift
//  SwiftConcurrency
//
//  Created by –ê–ª–∞–Ω –ü–∞—Ä–∞—Å—Ç–∞–µ–≤ on 26.10.2025.
//
/*
 ‚ú¥Ô∏è –ß—Ç–æ —Ç–∞–∫–æ–µ Sendable:

 ‚úÖ Sendable ‚Äî —ç—Ç–æ –ø—Ä–æ—Ç–æ–∫–æ–ª, –≤–≤–µ–¥—ë–Ω–Ω—ã–π –≤ Swift 5.5 –≤–º–µ—Å—Ç–µ —Å —Å–∏—Å—Ç–µ–º–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (async/await, actors).
    –û–Ω –ø–æ–º–µ—á–∞–µ—Ç —Ç–∏–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –º–µ–∂–¥—É –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º–∏ ‚Äî —Ç–æ –µ—Å—Ç—å —Ç–∏–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ ¬´–æ—Ç–ø—Ä–∞–≤–∏—Ç—å¬ª (send) –≤ –¥—Ä—É–≥—É—é –∑–∞–¥–∞—á—É –±–µ–∑ —Ä–∏—Å–∫–∞ –≥–æ–Ω–æ–∫ –¥–∞–Ω–Ω—ã—Ö.
 
 ‚úÖ –ï—Å–ª–∏ —Ç—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–∑—ã–≤–∞–µ—à—å Task –≤–Ω—É—Ç—Ä–∏ View –∏–ª–∏ ObservableObject, —Ç–æ Swift –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –ø–µ—Ä–µ–¥–∞—ë—à—å –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏, –±–µ–∑–æ–ø–∞—Å–Ω—ã –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.–ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –Ω–µ Sendable, –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –≤—ã–¥–∞—Å—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∏–ª–∏ –æ—à–∏–±–∫—É.
 */
import SwiftUI
import Combine

/*
 ‚úÖ actor ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–∏–ø, –∫–æ—Ç–æ—Ä—ã–π –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.–í—Å—ë, —á—Ç–æ –≤–Ω—É—Ç—Ä–∏ –∞–∫—Ç–æ—Ä–∞, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ–¥–Ω–æ–º –ø–æ—Ç–æ–∫–µ, —Ç–∞–∫ —á—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≥–æ–Ω–æ–∫ –¥–∞–Ω–Ω—ã—Ö.

 ‚úÖ –ú–µ—Ç–æ–¥ updateDatabase(userInfo:) –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–±—ä–µ–∫—Ç MyClassUserInfo –∏ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç (–ø–æ–∫–∞).–í —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑—É.

 üìò –í–∞–∂–Ω–æ:
 –ß—Ç–æ–±—ã –ø–µ—Ä–µ–¥–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –∞–∫—Ç–æ—Ä, –æ–±—ä–µ–∫—Ç userInfo –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º.
 –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Sendable ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª, –∫–æ—Ç–æ—Ä—ã–π –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ–±—ä–µ–∫—Ç –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏.
 ‚ùå –ï—Å–ª–∏ –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏, –µ—Å–ª–∏ –º—ã –ø–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ actor(–æ–Ω –ø–æ—Ç–æ–∫–∞–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–ª–∞—Å—Å) –∏–∑ class(—Å—Å—ã–ª–æ—á–Ω—ã–π —Ç–∏–ø –Ω–µ –ø–æ—Ç–æ–∫–∞–±–µ–∑–æ–ø–∞—Å–Ω—ã–π) –±—É–¥–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã –∏ —á—Ç–æ –±—ã –∏–∑ –±–∏–∂–∞—Ç—å —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å class –ø–æ—Ç–æ–∫–∞–±–µ–∑–æ–ø–∞—Å–Ω—ã–º(–∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ –Ω–∏–∂–µ)
 ‚ö†Ô∏è –°—Ç—Ä–∫—É—Ç—É—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã, (–ø—Ä–∏–º–µ—Ä –≤ –Ω–∏–∑—É MyUserInfo) , —Ç–∞–∫–∂–µ –≤–∞–∂–Ω–æ —á—Ç–æ –±—ã —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–¥–µ—Ä–∂–∞–ª–∞ —Ç–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–∏–ø—ã, —Ç–∏–ø –∑–Ω–∞—á–µ–Ω–∏—è: Struct, Enum, String, Int...
 ‚ö†Ô∏è –û–Ω–∞ —è–≤–Ω–æ –ø–æ–º–µ—á–µ–Ω–∞ Sendable, —á—Ç–æ–±—ã –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –∑–Ω–∞–ª, —á—Ç–æ –µ—ë –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏ (–ø–æ—Ç–æ–∫–∞–º–∏).
 */
actor CurrentUserManager {
    
    func updateDatabase(userInfo: MyClassUserInfo) {
        }
    }

struct MyUserInfo: Sendable {
    var name: String
}

/*
 ‚úÖ class ‚Äî —Å—Å—ã–ª–æ—á–Ω—ã–π —Ç–∏–ø, –∞ –∫–ª–∞—Å—Å—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –ø–æ—Ç–æ–∫–∞–±–µ–∑–æ–ø–∞—Å–Ω—ã –∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç Sendable,–ø–æ—ç—Ç–æ–º—É –º—ã –¥–µ–ª–∞–µ–º –µ–≥–æ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º, –Ω–æ –ª—É—á—à–µ –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã(–æ–Ω–∏ –±–æ–ª—å—à–µ –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–¥—Ö–æ–¥—è—Ç)

 ‚ö†Ô∏è  @unchecked Sendable: –û–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –±–µ—Ä—ë—Ç –Ω–∞ —Å–µ–±—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≥–æ–≤–æ—Ä–∏—Ç –∫–æ–º–ø–µ–ª—è—Ç–æ—Ä—É –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —ç—Ç–æ—Ç –∫–ª–∞—Å—Å –Ω–∞ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å! ‚ùå –ù–ï –ñ–ï–õ–ê–¢–ï–õ–¨–ù–û –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ @unchecked –í –ö–û–î–ï,–ú–û–ñ–ù–û –ï–ì–û –£–î–ê–õ–ò–¢–¨ –ò –û–®–ò–ë–û–ö –ù–ï –ë–£–î–ï–¢, –û–¢–ê–í–ò–õ –ï–ì–û –ü–†–û–°–¢–û –ß–¢–û –ë–´ –ó–ù–ê–¢–¨ –ß–¢–û –¢–ê–ö–û–ï –ï–°–¢–¨  ‚ùå

 ‚úÖ –ß—Ç–æ–±—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∫–ª–∞—Å—Å –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º: –µ—Å—Ç—å —Å–≤–æ—è DispatchQueue (queue), –≥–¥–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è; –≤ –º–µ—Ç–æ–¥–µ updateName(name:) –∏–º—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ queue.async, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –Ω–µ –±—É–¥–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ self.name –∏–∑ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤.
     –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –∫–ª–∞—Å—Å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –±–µ–∑–æ–ø–∞—Å–µ–Ω, —Ö–æ—Ç—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä —ç—Ç–æ–≥–æ —Å–∞–º –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç.
 */
final class MyClassUserInfo: @unchecked Sendable {
    private var name: String
    let queue = DispatchQueue(label: "com.MyApp.MyClassUserInfo")
    
    init(name: String) {
        self.name = name
    }
    
    func updateName(name: String) {
        queue.async {
            self.name = name
        }
    }
}

/*
 ‚úÖ –ö–ª–∞—Å—Å ‚Äî —ç—Ç–æ ObservableObject, –∑–Ω–∞—á–∏—Ç, –µ–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ SwiftUI –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö.–û–Ω —Å–æ–∑–¥–∞—ë—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –∞–∫—Ç–æ—Ä–∞ CurrentUserManager. –¥–∞–ª–µ–µ ->
      ‚û°Ô∏è –ú–µ—Ç–æ–¥ updateCurrentUserInfo():
      ‚û°Ô∏è —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç MyClassUserInfo;
      ‚û°Ô∏è –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ –∞–∫—Ç–æ—Ä–∞ updateDatabase(userInfo:) —Å –ø–æ–º–æ—â—å—é await.
      ‚û°Ô∏è await –Ω—É–∂–µ–Ω, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤—ã–∑–æ–≤ –∞–∫—Ç–æ—Ä–∞ ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, —Ç–∞–∫ –∫–∞–∫ –¥–æ—Å—Ç—É–ø –∫ –µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ.
 */
class SendableBootcampViewModel: ObservableObject {
    
    var manager = CurrentUserManager()
    
    func updateCurrentUserInfo() async {
        let info = MyClassUserInfo(name: "info")
        await manager.updateDatabase(userInfo: info)
    }
}

struct SendableBootcamp: View {
    
    @StateObject var vm = SendableBootcampViewModel()
    
    var body: some View {
        Text("Hello, World!")
            .task {
                await vm.updateCurrentUserInfo()
            }
    }
}

#Preview {
    SendableBootcamp()
}
